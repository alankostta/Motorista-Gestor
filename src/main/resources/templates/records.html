<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layout/base :: layout(~{:: .content})}">
<head>
<title>Registros - DriveManager</title>
</head>
<body>
	<div class="content">
		<!-- Header -->
		<div class="d-flex justify-content-between align-items-center mb-4">
			<div>
				<h1 class="h2">Meus Registros</h1>
				<p class="text-muted">Gerencie seus registros diários de
					trabalho</p>
			</div>
			<a th:href="@{/records/new}" class="btn btn-success"> <i
				class="fas fa-plus me-2"></i>Novo Registro
			</a>
		</div>

		<!-- Mensagens de Feedback -->
		<div th:if="${successMessage}"
			class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="fas fa-check-circle me-2"></i><span
				th:text="${successMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>

		<!-- Tabela de Registros -->
		<div class="card">
			<div class="card-body">
				<div th:if="${#lists.isEmpty(records)}"
					class="text-center text-muted py-5">
					<i class="fas fa-calendar-alt fa-4x mb-3"></i>
					<h4>Nenhum registro encontrado</h4>
					<p>Comece criando seu primeiro registro de trabalho.</p>
					<a th:href="@{/records/new}" class="btn btn-primary">Criar
						Primeiro Registro</a>
				</div>
				<div th:unless="${#lists.isEmpty(records)}" class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Data</th>
								<th>Plataforma</th>
								<th>Carro</th>
								<th>Horas</th>
								<th>Km</th>
								<th>Ganhos</th>
								<th>Custos</th>
								<th>Lucro</th>
								<th>Ações</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="record : ${records}">
								<td th:text="${#temporals.format(record.date, 'dd/MM/yyyy')}"></td>
								<td>
									<!-- Bloco responsável por exibir a badge com a cor correta -->
									<th:block th:switch="${record.appPlatform.toString()}">

										<!-- Caso seja UBER -->
										<span th:case="'UBER'" class="badge bg-dark text-white"
											th:text="${record.appPlatform.displayName}"> UBER </span>

										<!-- Caso seja 99 -->
										<span th:case="'NOVENTA_NOVE'" class="badge bg-warning text-dark"
											th:text="${record.appPlatform.displayName}"> 99 </span>

										<!-- Caso seja INDRIVER -->
										<span th:case="'INDRIVER'" class="badge bg-success text-white"
											th:text="${record.appPlatform.displayName}"> INDRIVER </span>

										<!-- Qualquer outro valor (fallback) -->
										<span th:case="*" class="badge bg-light text-dark"
											th:text="${record.appPlatform.displayName != null ? record.appPlatform.displayName : 'N/A'}">
											N/A </span>

									</th:block>
								</td>
								<td><small
									th:text="${record.car.brand} + ' ' + ${record.car.model}"></small>
								</td>
								<td th:text="${record.hoursWorked} + 'h'"></td>
								<td th:text="${record.kmDriven} + ' km'"></td>
								<td class="text-success fw-bold"
									th:text="'R$ ' + ${record.grossEarnings}"></td>
								<td class="text-danger" th:text="'R$ ' + ${record.totalCosts}"></td>
								<td class="fw-bold"
									th:classappend="${record.netProfit >= 0 ? 'text-success' : 'text-danger'}"
									th:text="'R$ ' + ${record.netProfit}"></td>
								<td>
									<div
										class="d-flex justify-content-center align-items-center gap-2">
										<a th:href="@{/records/edit/{id}(id=${record.id})}"
											class="text-primary" title="Editar"
											style="border: none; background: none;"> <i
											class="fas fa-edit fa-lg"></i>
										</a>

										<form th:action="@{/records/delete/{id}(id=${record.id})}"
											method="post" class="m-0 p-0"
											onsubmit="return confirm('Tem certeza que deseja excluir este registro?')"
											style="display: inline;">
											<button type="submit" class="text-danger" title="Excluir"
												style="border: none; background: none; padding: 0;">
												<i class="fas fa-trash fa-lg"></i>
											</button>
										</form>
									</div>
								</td>

							</tr>
						</tbody>
					</table>
					<br>
					<div class="row">
						<div class="col">
							Exibindo página <span th:text="${currentPage + 1}"></span> de <span
								th:text="${totalPages}"></span>
						</div>
						<nav aria-label="Page navigation example">
							<ul class="pagination justify-content-center">
								<li th:classappend="${currentPage == 0} ? 'disabled'"><a
									class="page-link"
									th:href="@{/records(page=${currentPage - 1})}">Anterior</a></li>
								<li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
									th:classappend="${i == currentPage} ? 'active'"><a
									class="page-link" th:href="@{/records(page=${i})}"
									th:text="${i + 1}"></a></li>
								<li
									th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
									<a class="page-link"
									th:href="@{/records(page=${currentPage + 1})}">Próximo</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>