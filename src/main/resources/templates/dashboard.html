<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	th:replace="~{layout/base :: layout(~{:: .content})}">
<head>
<title>Dashboard - DriveManager</title>
</head>
<body>
	<div class="content">
		<!-- Header -->
		<div class="d-flex justify-content-between align-items-center mb-4">
			<div>
				<h1 class="h2">
					Dashboard <i class="bi bi-bar-chart-line"></i>
				</h1>
				<p class="text-muted">
					Bem-vindo de volta, <span
						th:text="${currentUser?.fullName} ?: 'Usuário'">Usuário</span>!
				</p>
			</div>
			<a th:href="@{/records/new}" class="btn btn-success"> <i
				class="fas fa-plus me-2"></i>Novo Registro
			</a>
		</div>

		<!-- Cards de Estatísticas -->
		<div class="row mb-4">
			<div class="col">
				<div class="card bg-primary text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Ganhos Totais</p>
								<h4
									th:text="${#numbers.formatCurrency(analytics?.totalEarnings ?: 0)}">R$
									0,00</h4>
							</div>
							<i class="fas fa-dollar-sign fa-2x opacity-75"></i>
						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card bg-danger text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Despesa</p>
								<h4>R$ 0,00</h4>
							</div>
						
							<i class="fas fa-arrow-down fa-2x opacity-75"></i>

						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card bg-success text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Lucro Líquido</p>
								<h4
									th:text="${#numbers.formatCurrency(analytics?.netProfit ?: 0)}">R$
									0,00</h4>
							</div>
							<i class="fas fa-chart-line fa-2x opacity-75"></i>
						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card bg-info text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Total de Horas</p>
								<h4
									th:text="${analytics?.totalHours != null} ? ${analytics.totalHours + 'h'} : '0h'">0h</h4>
							</div>
							<i class="fas fa-clock fa-2x opacity-75"></i>
						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card bg-warning text-dark">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Ganho/Hora</p>
								<h4
									th:text="${#numbers.formatCurrency(analytics?.earningsPerHour ?: 0)}">R$
									0,00</h4>
							</div>
							<i class="fas fa-tachometer-alt fa-2x opacity-75"></i>
						</div>
					</div>
				</div>
			</div>
	
		</div>
		<div class="row">
					<div class="col">
				<div class="card bg-secondary text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Carros Cadastrados</p>
								<h4 th:text="${analytics.totalCars}"></h4>
							</div>
							<i class="fas fa-car-rear fa-2x opacity-75"></i>
						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="card bg-dark text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<p class="card-text">Manutenção</p>
								<h4>R$ 0,00</h4>
							</div>
							<i class="fas fa-wrench fa-2x opacity-75"></i>

						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		<!-- Registros Recentes -->
		<div class="row">
			<div class="col">
				<div class="card">
					<div
						class="card-header d-flex justify-content-between align-items-center">
						<h5 class="card-title mb-0">Registros Recentes</h5>
						<a th:href="@{/records}" class="btn btn-outline-primary btn-sm">Ver
							Todos</a>
					</div>
					<div class="card-body">
						<div th:if="${#lists.isEmpty(recentRecords)}"
							class="text-center text-muted py-4">
							<i class="fas fa-calendar-alt fa-3x mb-3"></i>
							<p>Nenhum registro encontrado.</p>
							<a th:href="@{/records/new}" class="btn btn-primary">Criar
								Primeiro Registro</a>
						</div>
						<div th:unless="${#lists.isEmpty(recentRecords)}"
							class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>Data</th>
										<th>Plataforma</th>
										<th>Horas</th>
										<th>Ganhos</th>
										<th>Lucro</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="record : ${recentRecords}">
										<td th:text="${#temporals.format(record?.date, 'dd/MM/yyyy')}">--</td>
										<td>
											<!-- Bloco responsável por exibir a badge com a cor correta -->
											<th:block th:switch="${record.appPlatform.toString()}">

												<!-- Caso seja UBER -->
												<span th:case="'UBER'" class="badge bg-dark text-white"
													th:text="${record.appPlatform.displayName}"> UBER </span>

												<!-- Caso seja 99 -->
												<span th:case="'NOVENTA_NOVE'"
													class="badge bg-warning text-dark"
													th:text="${record.appPlatform.displayName}"> 99 </span>

												<!-- Caso seja INDRIVER -->
												<span th:case="'INDRIVER'"
													class="badge bg-success text-white"
													th:text="${record.appPlatform.displayName}">
													INDRIVER </span>

												<!-- Qualquer outro valor (fallback) -->
												<span th:case="*" class="badge bg-light text-white"
													th:text="${record.appPlatform.displayName != null ? record.appPlatform.displayName : 'N/A'}">
													N/A </span>
											</th:block>
										</td>
										<td
											th:text="${record?.hoursWorked != null} ? ${record.hoursWorked + 'h'} : '0h'">0h</td>
										<td class="text-success fw-bold"
											th:text="${#numbers.formatCurrency(record?.grossEarnings ?: 0)}">R$
											0,00</td>
										<td class="fw-bold"
											th:classappend="${record?.netProfit >= 0} ? 'text-success' : 'text-danger'"
											th:text="${#numbers.formatCurrency(record?.netProfit ?: 0)}">R$
											0,00</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="graf col-md-12">
					<div class="cartao card">
						<div class="cartaoH  card-header">
							<h5 class="ch">Ganhos vs Custos (Mês Atual)</h5>
						</div>
						<div class="cartaoC card-content">
							<canvas id="monthlyChart"></canvas>
						</div>
					</div>
				</div>
				<br>
			</div>
			<div class=" col-md-12">
				<div class="card">
					<div class="card-header">
						<h5 class="card-title mb-0">Resumo Geral</h5>
					</div>
					<div class="card-body">
						<ul class="list-group list-group-flush">
							<li class="list-group-item d-flex justify-content-between">
								<span>Total de Registros:</span> <strong
								th:text="${analytics?.totalRecords ?: 0}">0</strong>
							</li>
							<li class="list-group-item d-flex justify-content-between">
								<span>Total de Carros:</span> <strong
								th:text="${totalCars ?: 0}">0</strong>
							</li>
							<li class="list-group-item d-flex justify-content-between">
								<span>Km Total:</span> <strong
								th:text="${analytics?.totalKm ?: 0} + ' km'">0 km</strong>
							</li>
							<li class="list-group-item d-flex justify-content-between">
								<span>Custo Total:</span> <strong class="text-danger"
								th:text="${#numbers.formatCurrency(analytics?.totalCosts ?: 0)}">R$
									0,00</strong>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>